# OpenClaw 开发同步指南

## 项目基本信息

| 项目 | 说明 |
|---|---|
| **本地路径** | `/Users/dinglingyun/Desktop/OpenClaw/` |
| **官方仓库 (upstream)** | `git@github.com:openclaw/openclaw.git` |
| **个人 Fork (origin)** | `git@github.com:Dinglingyun2022/openclaw.git` |
| **日常工作分支** | `my-dev`（所有二次开发在此分支） |
| **上游镜像分支** | `main`（纯净镜像，不在此分支做任何修改） |

## 分支策略

```
upstream/main (官方最新)
      │
      │ fetch + merge
      ▼
本地 main ──────── 纯净镜像，只用于同步上游，绝不修改
      │
      │ merge
      ▼
本地 my-dev ────── 二次开发分支，日常在此工作
      │
      │ push
      ▼
origin/my-dev ──── GitHub fork 备份
```

**核心原则**：

- `main` 分支 = 官方上游的纯净副本，**永远不在 main 上直接改代码**
- `my-dev` 分支 = 官方代码 + 你的二次开发内容
- 尽量通过**新增文件/目录**的方式做二次开发，避免修改官方源文件，以减少合并冲突

## 日常开发

在 `my-dev` 分支上正常开发，改完后提交并推送：

```bash
cd /Users/dinglingyun/Desktop/OpenClaw

# 确认在 my-dev 分支
git checkout my-dev

# 提交修改
git add .
git commit -m "描述你的修改"
git push
```

## 同步上游更新

当官方仓库（openclaw/openclaw）发布了新版本或有重要更新时，执行以下步骤：

```bash
cd /Users/dinglingyun/Desktop/OpenClaw

# 第 1 步：更新 main 镜像
git checkout main
git fetch upstream
git merge upstream/main
git push origin main

# 第 2 步：将更新合并到开发分支
git checkout my-dev
git merge main

# 第 3 步：如果有冲突，手动解决后执行
# git add .
# git commit -m "resolve merge conflicts with upstream"

# 第 4 步：更新依赖并重新构建
pnpm install
pnpm build

# 第 5 步：推送到 fork
git push
```

## 合并冲突处理

同步时如果出现冲突（你和官方改了同一个文件的同一处），Git 会标记冲突文件：

1. 在 Cursor 中打开冲突文件，会看到类似标记：

   ```
   <<<<<<< HEAD
   你的修改内容
   =======
   官方的新内容
   >>>>>>> main
   ```

2. 选择保留哪一方（或合并两者），删除标记符号
3. 保存后执行 `git add .` 和 `git commit`

**减少冲突的最佳实践**：将二次开发内容放在独立的文件或目录中（如 `docs/` 下的自定义文档、`my-scripts/` 等），尽量不修改 `src/` 下的官方源码。

## 全局安装版更新（日常使用）

全局安装的 CLI 版本独立于源码项目，直接通过 npm 更新：

```bash
sudo npm i -g openclaw@latest
openclaw --version
```

## 常用 Git 命令速查

```bash
# 查看当前分支
git branch

# 查看远程仓库配置
git remote -v

# 查看上游有哪些新提交（不合并，只看）
git fetch upstream
git log main..upstream/main --oneline

# 查看本地修改状态
git status

# 查看未提交的改动
git diff
```
